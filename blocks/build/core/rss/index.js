(()=>{"use strict";var e,t={387:(e,t,r)=>{const n=window.wp.blocks;var o=r(609);const a=window.wp.i18n,s=window.wp.data,l=window.wp.element,c=window.wp.components,i=window.wp.compose,p=window.wp.blockEditor,u=window.wp.primitives;var d=r(848);const m=(0,d.jsxs)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:[(0,d.jsx)(u.Path,{d:"m19 7.5h-7.628c-.3089-.87389-1.1423-1.5-2.122-1.5-.97966 0-1.81309.62611-2.12197 1.5h-2.12803v1.5h2.12803c.30888.87389 1.14231 1.5 2.12197 1.5.9797 0 1.8131-.62611 2.122-1.5h7.628z"}),(0,d.jsx)(u.Path,{d:"m19 15h-2.128c-.3089-.8739-1.1423-1.5-2.122-1.5s-1.8131.6261-2.122 1.5h-7.628v1.5h7.628c.3089.8739 1.1423 1.5 2.122 1.5s1.8131-.6261 2.122-1.5h2.128z"})]});function w({attributes:{postPerPage:e,offset:t},setAttributes:r}){return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(c.ToolbarGroup,null,(0,o.createElement)(c.Dropdown,{contentClassName:"block-library-query-toolbar__popover",renderToggle:({onToggle:e})=>(0,o.createElement)(c.ToolbarButton,{icon:m,label:(0,a.__)("Display settings"),onClick:e}),renderContent:()=>(0,o.createElement)(o.Fragment,null,(0,o.createElement)(c.__experimentalNumberControl,{__unstableInputWidth:"60px",className:"block-library-query-toolbar__popover-number-control",label:(0,a.__)("Items per Page"),labelPosition:"edge",min:1,max:100,onChange:e=>{isNaN(e)||e<1||e>100||r({postPerPage:parseInt(e)})},step:"1",value:e,isDragEnabled:!1}),(0,o.createElement)(c.__experimentalNumberControl,{__unstableInputWidth:"60px",className:"block-library-query-toolbar__popover-number-control",label:(0,a.__)("Offset"),labelPosition:"edge",min:0,max:100,onChange:e=>{e<0||e>100||r({offset:parseInt(e)})},step:"1",value:t,isDragEnabled:!1}))})))}const f=(0,l.forwardRef)((function({icon:e,size:t=24,...r},n){return(0,l.cloneElement)(e,{width:t,height:t,...r,ref:n})})),h=(0,d.jsx)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(u.Path,{d:"M16.7 7.1l-6.3 8.5-3.3-2.5-.9 1.2 4.5 3.4L17.9 8z"})}),b=(0,d.jsx)(u.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(u.Path,{d:"M13 11.8l6.1-6.3-1-1-6.1 6.2-6.1-6.2-1 1 6.1 6.3-6.5 6.7 1 1 6.5-6.6 6.5 6.6 1-1z"})}),g={fill:"#fff",width:"30px",height:"30px",borderRadius:"50%"},_=e=>{const{url:t,onChange:r}=e;return(0,l.useEffect)((()=>{r(t)}),[t]),(0,o.createElement)(o.Fragment,null,(0,o.createElement)("div",{className:"rss-url-control"},(0,o.createElement)(c.TextControl,{label:"URL",value:t,onChange:r,className:"rss-url-control__input"}),(e=>{try{return"https:"===new URL(e).protocol}catch(e){return!1}})(t)?(0,o.createElement)(f,{icon:h,style:{...g,padding:"2px",background:"green"}}):(0,o.createElement)(f,{icon:b,style:{...g,padding:"5px",background:"red"}})))},v=[["ctlt/api-rss-template",{},[["ctlt/api-rss-image",{}],["ctlt/api-rss-title",{}],["ctlt/api-rss-dates",{}],["ctlt/api-rss-excerpt",{moreText:"READ MORE"}]]],["ubc/api-pagination",{}],["ubc/api-no-results",{}]],E=JSON.parse('{"UU":"ubc/ctlt-rss"}');(0,n.registerBlockType)(E.UU,{edit:function e(t){const r=(0,p.useBlockProps)(),{clientId:n,attributes:a,setAttributes:u}=t,{source:d,instanceId:m,postPerPage:f,offset:h}=a,[b,g]=(0,l.useState)([]),{__unstableMarkNextChangeAsNotPersistent:E}=(0,s.useDispatch)(p.store),k=(0,i.useInstanceId)(e);(0,l.useEffect)((()=>{x()}),[f,h]),(0,l.useEffect)((()=>{Number.isFinite(m)||(E(),u({instanceId:k}))}),[m,k]);const y=(0,s.useSelect)((e=>!!e(p.store).getBlocks(n).length),[n]),x=async()=>{const e=await(async(e,t)=>{const r=new FormData;r.append("action","fetch_rss"),r.append("source",JSON.stringify(e));for(let e in t)r.append(e,t[e]);const n=await fetch(ajaxurl,{method:"POST",credentials:"same-origin",body:r}),o=await n.json();return!!o.success&&o.data})(wp.hooks.applyFilters("ctlt-rss-block.setData",d,a),{per_page:f,current_page:1,offset:h});g(e.items)};return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(p.BlockContextProvider,{value:{resources:b}},y?(0,o.createElement)("div",{...r},(0,o.createElement)(p.InnerBlocks,{templateLock:!1,renderAppender:p.InnerBlocks.DefaultBlockAppender,templateInsertUpdatesSelection:!0})):(0,o.createElement)(p.InnerBlocks,{templateLock:!1,template:v,renderAppender:p.InnerBlocks.DefaultBlockAppender,templateInsertUpdatesSelection:!0})),(0,o.createElement)(p.BlockControls,null,(0,o.createElement)(w,{attributes:a,setAttributes:u})),(0,o.createElement)(p.InspectorControls,null,(0,o.createElement)(c.PanelBody,{title:"Settings",initialOpen:!1},(0,o.createElement)(_,{url:d,onChange:e=>{u({source:e})}}),wp.hooks.applyFilters("ctlt-rss-block.settings","",t),(0,o.createElement)("br",null),(0,o.createElement)(o.Fragment,null,(0,o.createElement)(c.Button,{variant:"secondary",onClick:()=>{x()}},"Update"),(0,o.createElement)(c.Button,{style:{marginLeft:"10px"},variant:"secondary",onClick:async()=>{window.confirm("Are you sure you want to reset the cache for the current feed?")&&(await(async e=>{const t=new FormData;t.append("action","reset_rss_caches"),t.append("source",e);const r=await fetch(ajaxurl,{method:"POST",credentials:"same-origin",body:t});return(await r.json()).success})(wp.hooks.applyFilters("ctlt-rss-block.resetCache",d,a)),await x())}},"Reset Feed Cache")))))},save:()=>{const e=p.useBlockProps.save();return(0,o.createElement)("div",{...e},(0,o.createElement)(p.InnerBlocks.Content,null))}})},20:(e,t,r)=>{var n=r(609),o=Symbol.for("react.element"),a=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,c={},i=null,p=null;for(n in void 0!==r&&(i=""+r),void 0!==t.key&&(i=""+t.key),void 0!==t.ref&&(p=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(c[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===c[n]&&(c[n]=t[n]);return{$$typeof:o,type:e,key:i,ref:p,props:c,_owner:s.current}}t.jsx=c,t.jsxs=c},848:(e,t,r)=>{e.exports=r(20)},609:e=>{e.exports=window.React}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var a=r[e]={exports:{}};return t[e](a,a.exports,n),a.exports}n.m=t,e=[],n.O=(t,r,o,a)=>{if(!r){var s=1/0;for(p=0;p<e.length;p++){for(var[r,o,a]=e[p],l=!0,c=0;c<r.length;c++)(!1&a||s>=a)&&Object.keys(n.O).every((e=>n.O[e](r[c])))?r.splice(c--,1):(l=!1,a<s&&(s=a));if(l){e.splice(p--,1);var i=o();void 0!==i&&(t=i)}}return t}a=a||0;for(var p=e.length;p>0&&e[p-1][2]>a;p--)e[p]=e[p-1];e[p]=[r,o,a]},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={794:0,990:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var o,a,[s,l,c]=r,i=0;if(s.some((t=>0!==e[t]))){for(o in l)n.o(l,o)&&(n.m[o]=l[o]);if(c)var p=c(n)}for(t&&t(r);i<s.length;i++)a=s[i],n.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return n.O(p)},r=globalThis.webpackChunkctlt_rss_block=globalThis.webpackChunkctlt_rss_block||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var o=n.O(void 0,[990],(()=>n(387)));o=n.O(o)})();